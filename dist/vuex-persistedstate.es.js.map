{"version":3,"file":"vuex-persistedstate.es.js","sources":["../node_modules/deepmerge/dist/cjs.js","../src/index.ts","../node_modules/shvl/dist/shvl.mjs"],"sourcesContent":["'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import { Store, MutationPayload } from \"vuex\";\nimport merge from \"deepmerge\";\nimport * as shvl from \"shvl\";\n\ninterface Storage {\n  getItem: (key: string) => any;\n  setItem: (key: string, value: any) => void;\n  removeItem: (key: string) => void;\n}\n\ninterface Options<State> {\n  key?: string;\n  paths?: string[];\n  reducer?: (state: State, paths: string[]) => object;\n  subscriber?: (\n    store: Store<State>\n    ) => (handler: (mutation: any, state: State) => void) => void;\n  storage?: Storage;\n  getState?: (key: string, storage: Storage) => any;\n  setState?: (key: string, state: any, storage: Storage) => void;\n  filter?: (mutation: MutationPayload) => boolean;\n  arrayMerger?: (state: any[], saved: any[]) => any;\n  rehydrated?: (store: Store<State>) => void;\n  fetchBeforeUse?: boolean;\n  overwrite?: boolean;\n  assertStorage?: (storage: Storage) => void | Error;\n}\n\nexport default function <State>(\n  options?: Options<State>\n): (store: Store<State>) => void {\n  options = options || {};\n\n  const storage = options.storage || (window && window.localStorage);\n  const key = options.key || \"vuex\";\n\n  function getState(key, storage) {\n    const value = storage.getItem(key);\n\n    try {\n      return (typeof value === \"string\")\n        ? JSON.parse(value) : (typeof value === \"object\")\n        ? value : undefined;\n    } catch (err) {}\n\n    return undefined;\n  }\n\n  function filter() {\n    return true;\n  }\n\n  function setState(key, state, storage) {\n    return storage.setItem(key, JSON.stringify(state));\n  }\n\n  function reducer(state, paths) {\n    console.log(\"reducer\");\n    console.log(state);\n    console.log(paths);\n\n    return Array.isArray(paths)\n      ? paths.reduce(function (substate, path) {\n          return shvl.set(substate, path, shvl.get(state, path));\n        }, {})\n      : state;\n  }\n\n  function subscriber(store) {\n    console.log(\"[vuex-p]subscriber store\");\n    console.log(store);\n    return function (handler) {\n      return store.subscribe(handler);\n    };\n  }\n\n  const assertStorage =\n    options.assertStorage ||\n    (() => {\n      console.log(\"[vuex-p]test\");\n      storage.setItem(\"@@\", 1);\n      storage.removeItem(\"@@\");\n    });\n\n  assertStorage(storage);\n\n  const fetchSavedState = () => (options.getState || getState)(key, storage);\n\n  let savedState;\n\n  if (options.fetchBeforeUse) {\n    savedState = fetchSavedState();\n  }\n\n  return function (store: Store<State>) {\n    if (!options.fetchBeforeUse) {\n      savedState = fetchSavedState();\n    }\n\n    if (typeof savedState === \"object\" && savedState !== null) {\n      store.replaceState(\n        options.overwrite\n          ? savedState\n          : merge(store.state, savedState, {\n              arrayMerge:\n                options.arrayMerger ||\n                function (store, saved) {\n                  return saved;\n                },\n              clone: false,\n            })\n      );\n      (options.rehydrated || function () {})(store);\n    }\n\n    (options.subscriber || subscriber)(store)(function (mutation, state) {\n      console.log(\"[vuex-p]state\");\n      console.log(state);\n      console.log(\"[vuex-p]options\");\n      console.log(options);\n      console.log(\"[vuex-p]filter\");\n      console.log(filter);\n      console.log(\"[vuex-p]options.filter\");\n      console.log(options.filter);\n      console.log(\"[vuex-p]setState\");\n      console.log(setState);\n      console.log(\"[vuex-p]options.setState\");\n      console.log(options.setState);\n      console.log(\"[vuex-p]options.reducer\");\n      console.log(options.reducer);\n      console.log(\"[vuex-p]reducer\");\n      console.log(reducer);\n      console.log(\"[vuex-p]options.paths\");\n      console.log(options.paths);\n\n      if ((options.filter || filter)(mutation)) {\n        console.log(\"[vuex-p]in filter\");\n        (options.setState || setState)(\n          key,\n          (options.reducer || reducer)(state, options.paths),\n          storage\n        );\n      }\n    });\n  };\n}\n","function t(t,r,e){return void 0===(t=(r.split?r.split(\".\"):r).reduce(function(t,r){return t&&t[r]},t))?e:t}function r(t,r,e,n){return!/^(__proto__|constructor|prototype)$/.test(r)&&((r=r.split?r.split(\".\"):r.slice(0)).slice(0,-1).reduce(function(t,r){return t[r]=t[r]||{}},t)[r.pop()]=e),t}export{t as get,r as set};\n//# sourceMappingURL=shvl.mjs.map\n"],"names":["isMergeableObject","value","isNonNullObject","stringValue","Object","prototype","toString","call","$$typeof","REACT_ELEMENT_TYPE","isReactElement","isSpecial","Symbol","for","cloneUnlessOtherwiseSpecified","options","clone","deepmerge","Array","isArray","defaultArrayMerge","target","source","concat","map","element","getKeys","keys","getOwnPropertySymbols","filter","symbol","propertyIsEnumerable","getEnumerableOwnPropertySymbols","propertyIsOnObject","object","property","_","arrayMerge","sourceIsArray","destination","forEach","key","hasOwnProperty","propertyIsUnsafe","customMerge","getMergeFunction","mergeObject","all","array","Error","reduce","prev","next","cjs","storage","window","localStorage","getState","getItem","JSON","parse","undefined","err","setState","state","setItem","stringify","reducer","paths","console","log","substate","path","t","r","e","n","test","split","slice","pop","shvl","subscriber","store","handler","subscribe","assertStorage","removeItem","savedState","fetchSavedState","fetchBeforeUse","replaceState","overwrite","merge","arrayMerger","saved","rehydrated","mutation"],"mappings":"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"}